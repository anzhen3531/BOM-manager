class AjaxResult{constructor(a){if(!a||4!==a.readyState)throw new Error("Request has no result");this.request=a,this.response=a.response,this.url=a.responseURL,this.status=a.status,this.statusText=a.statusText,this.hasError=!(100<=a.status&&400>a.status)}get document(){return this._get("document",()=>{let a=this.request.responseXML;if(!a){let b=this.headers["content-type"];b&&(b.includes("xml")||b.includes("html"))&&(a=new DOMParser().parseFromString(this.text,b.split(";")[0]))}return a})}get text(){return this._get("text",()=>this.request.responseText||(this.response||"").toString())}get headers(){return this._get("headers",()=>{let a=this.request.getAllResponseHeaders(),b=(a||"").split("\r\n").map(a=>{let b=a.split(": ");return 1<b.length?[b.shift(),b.join(": ")]:null}).filter(a=>a).reduce((a,b)=>(a[b[0]]=b[1],a),{});return b.contains=function(a){return this.hasOwnProperty(a.toLowerCase())},b.get=function(a){return this[a.toLowerCase()]},b})}get type(){return this._get("type",()=>{let a=this.request.responseType;if(!a&&(a=this.headers["content-type"],a)){let b=a.split("/");a=b[b.length-1].split(";")[0]}return a})}get value(){return this._get("value",()=>JSON.parse(this.text))}_get(a,b){let c=`_${a}`;if(this[c]===void 0)try{this[c]=b()}catch(a){this[c]=null}return this[c]}}const ajax=function(){function a(a){if(!a)return new FormData;if(a instanceof HTMLFormElement)return new FormData(a);if("string"==typeof a){let b=document.querySelector(a);if(b instanceof HTMLFormElement)return new FormData(b)}let b=new FormData;if("object"==typeof a)for(let c in a)b.append(c,a[c]);else b.append("value",a);return b}function b(a){let b="";for(let c of a.keys()){let d=encodeURIComponent(c),e=a.getAll(c);if(1===e.length)b+=`&${d}=${encodeURIComponent(e[0])}`;else for(let a=0;a<e.length;++a)b+=`&${d}[${a}]=${encodeURIComponent(e[a])}`}return b.substring(1)}function c(a,b){if(b&&"object"==typeof b)for(let c in b)a.setRequestHeader(c,b[c])}function d(a,d,e,f,g){return new Promise(function(i){e=e.toUpperCase();let j=new h;if("function"==typeof g.onProgress&&j.addEventListener("progress",g.onProgress),j.upload&&"function"==typeof g.onUploadProgress&&j.upload.addEventListener("progress",g.onUploadProgress),j.addEventListener("readystatechange",function(){if(4===j.readyState){let a=new AjaxResult(j);"function"==typeof g.beforeReturn&&g.beforeReturn(a,j),i(a)}}),"GET"===e||"HEAD"===e){let h=b(d);j.open(e,a+(h?"?":"")+h),c(j,f),"function"==typeof g.beforeSend&&g.beforeSend(j),j.send()}else j.open(e,a),c(j,f),"function"==typeof g.beforeSend&&g.beforeSend(j),j.send(d)})}function e(a){return"string"==typeof a[0]?f(a[0],a[1]):a[0]instanceof HTMLFormElement?g(a[0],a[1]):a[0]||{}}function f(a,b){return{url:a,...(b||{})}}function g(a,b){return{url:a.action,method:a.method,data:a,...(b||{})}}const h=XMLHttpRequest;if(!h)throw new Error("XMLHttpRequest is unavailable");const i=function(){let{url:b,method:c,type:f,data:g,content:h,success:j,error:k,statusCode:l,headers:m,onProgress:n,onUploadProgress:o,beforeSend:p,beforeReturn:q,modifier:r}={...i.defaultSettings,...e([...arguments])};if(!b)throw new Error("URL wasn't specified");r=r||{},r.onProgress=r.onProgress||n,r.onUploadProgress=r.onUploadProgress||o,r.beforeSend=r.beforeSend||p,r.beforeReturn=r.beforeReturn||q;let s=a(g||h),t=d(b,s,c||f||"GET",m,r);return l&&(t=t.then(a=>{let b=l[a.status];return b&&b(a),a})),j&&(t=t.then(a=>(a.hasError||j(a),a))),k&&(t=t.then(a=>(a.hasError&&k(a),a))),t};return i.defaultSettings={url:"",type:"GET",content:null,success:null,error:null,statusCode:null,headers:null,interval:1e3,confirmation:()=>!0,beforeSend:null,beforeReturn:null,modifier:null},i}();HTMLFormElement.prototype.addAjax=function(a,b){b=b||{};let c=b.confirmation;c="function"==typeof c?c:ajax.defaultSettings.confirmation;let d=+b.interval;d=isNaN(d)||0>d?ajax.defaultSettings.interval:d;let f,g=!1,h=()=>{g?g=!1:this.addEventListener("submit",f)};f=function(i){Promise.resolve(c.bind(this)()).then(c=>{!1!==c&&(this.removeEventListener("submit",f),g=!0,setTimeout(h,d),ajax(this,b).then(b=>{h(),i.response=b,a.bind(this)(i)}))})},this.addEventListener("submit",a=>a.preventDefault()),this.addEventListener("submit",f)};